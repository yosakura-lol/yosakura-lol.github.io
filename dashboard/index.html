<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Yosakura - Dashboard</title>
    <style>
        body { background: #0d0d0d; color: white; font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .dash-card { background: #1e1e1e; padding: 30px; border-radius: 20px; border: 1px solid #ff69b455; width: 400px; }
        h2 { color: #ff69b4; text-align: center; margin-bottom: 20px; }
        .user-lock { background: #111; padding: 10px; border-radius: 8px; text-align: center; font-weight: bold; color: #888; border: 1px dashed #444; margin-bottom: 20px; }
        label { display: block; font-size: 12px; color: #aaa; margin-bottom: 5px; text-transform: uppercase; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; background: #000; border: 1px solid #333; color: white; border-radius: 8px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; background: #ff69b4; border: none; color: white; font-weight: bold; border-radius: 10px; cursor: pointer; transition: 0.3s; }
        .btn:hover { background: #ff85c1; transform: translateY(-2); }
        .logout { display: block; text-align: center; margin-top: 15px; color: #666; font-size: 12px; text-decoration: none; }
    </style>
</head>
<body>
    <div class="dash-card">
        <h2>Mon Profil</h2>
        <div class="user-lock">Compte : <span id="locked-username">...</span></div>

        <label>Sous-titre (Bio)</label>
        <input type="text" id="subtitle" placeholder="Ex: Développeur & Gamer">

        <label>ID Discord (Lanyard)</label>
        <input type="text" id="discord_id" placeholder="Ex: 929651828747014164">

        <label>Lien Musique MP3</label>
        <input type="text" id="music_url" placeholder="https://exemple.com/music.mp3">

        <button class="btn" onclick="saveChanges()">Enregistrer les modifications</button>
        <a href="index.html" class="logout" onclick="localStorage.clear()">Déconnexion</a>
    </div>

    <script>
        // 1. On vérifie qui est connecté
        const currentUser = localStorage.getItem('yosakura_user');
        if (!currentUser) {
            window.location.href = "/login";
        }
        document.getElementById('locked-username').textContent = currentUser;

        async function saveChanges() {
            const btn = document.querySelector('.btn');
            btn.textContent = "Mise à jour...";
            btn.disabled = true;

            const newData = {
                username: currentUser, // Le pseudo est forcé ici !
                subtitle: document.getElementById('subtitle').value,
                discord_id: document.getElementById('discord_id').value,
                tracks: [
                    { 
                        src: document.getElementById('music_url').value, 
                        title: "Custom Track", 
                        cover: "https://r2.e-z.host/2082d509-df6d-4275-b000-03875323226f/f5m9a8j3.png" 
                    }
                ]
            };

            try {
                // On envoie vers ta route /update sur Vercel
                const response = await fetch("https://dashboard-backend-five-chi.vercel.app/update", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ 
                        username: currentUser, 
                        newData: newData 
                    })
                });

                if (response.ok) {
                    alert("Profil mis à jour avec succès !");
                } else {
                    alert("Erreur lors de la mise à jour.");
                }
            } catch (e) {
                console.error(e);
                alert("Erreur serveur.");
            } finally {
                btn.textContent = "Enregistrer les modifications";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
